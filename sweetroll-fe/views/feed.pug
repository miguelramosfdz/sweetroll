extends /_layout.pug

block append main
	//- Some pagination info: https://wiki.postgresql.org/images/3/35/Pagination_Done_the_PostgreSQL_Way.pdf
	simple-live(hidden src="/live")
		| This feed has been updated. 
		a.do-reload(href="#") Reload?
	section.index-category
		-
			obj.children = obj.children || []
			const qq = reqUriFull.search(true)
		each entry in obj.children.slice(firstI)
			if entry.deleted
				article.h-entry(hidden)
					.p-name Gone
					data.dt-deleted(value="1970-01-01T00:00:00")
			else
				try
					article.entry('class'=entry.type.join(' '))
						+showEntry(entry, true)
				catch
					div.tpl-error Error: could not render the entry
	nav.category-nav
		if obj.children.length >= 0
			-
				const href = reqUriFull.clone().search(q => {
					q.before = _.get(_.last(obj.children), 'properties.published[0]')
					q.after = undefined
				}).relativeTo(domainUri).toString()
			a(href=href rel="prev")
				+icon('arrow-down')
				| older
		= ' '
		if qq.before || qq.after
			-
				const href = reqUriFull.clone().search(q => {
					q.before = undefined
					q.after = _.get(_.head(obj.children), 'properties.published[0]')
				}).relativeTo(domainUri).toString()
			a(href=href rel="next")
				+icon('arrow-up')
				| newer
